语义 + 风格  =  合成图像

作者提出的空间自适应性归一化是一个神经网络层；
先前的方法，直接将语义布局喂入深度网络：卷积  归一化  非线性层

由于归一化层倾向于“洗去”语义信息，所以这种方法不是最优的。为了解决这个问题，
我们建议使用输入布局通过一个空间自适应学习变换来调节归一化层中的激活函数

条件图像合成是指在输入数据的基础上生成真实感图像。早期的方法是通过从图像数
据库中拼接图像片段来计算输出图像。最近的方法直接利用神经网络学习映射。后一种方法
通常更快，不需要外部图像数据库

将语义分割掩码转为相片般真实的图像，称为语义图像合成
测试数据集：COCO-Stuff, ADE20K, Cityscapes
支持多模态和风格导向的图像合成，是输出可控、多样

深层生成模型：合成随机采样图像，GANs, VAE
本文建立在GANs之上，针对的是条件图像合成任务

条件图像生成：根据输入数据类型不同分为多种形式；
类条件模型学习合成给定类别标签的图像
图像到图像映射，这个方法广泛被广泛使用，它的输入和输出都是图像；
本文的工作重点是转换分割掩码到逼真的图像，假设训练集中包含成对的分割掩码和图像

无条件的归一化层：现代深度网络中的重要组成部分，可以在各种分类器设计中找到，之所以把这些
规范化（归一化）层标记为无条件的，是因为它们不依赖于外部数据

条件归一化层：如Conditional Batch Normalization（Conditional BN）,Adaptive Instance Normalization（AdaIN），
这两种方法都是首先在样式（风格）转换任务中使用，然后在各种视觉任务中使用；特点是需要外部数据
操作：首先层激活函数被归一化为零均值和单位偏差。然后通过使用从外部数据推断参数的学习仿射变换对激活函数调节，使规范
化的激活函数去规范化
本文：对于样式传递任务，仿射参数用于控制输出的全局样式，因此在空间坐标上是一致的。不同于以往的工作，本文提出的归一化层
采用了空间变化的仿射变换，使得其适用于从空间变化的语义掩码进行图像合成

SPADE和Batch Normalization相似

生成器：
使用SPADE，不需要将分割映射提供给生成器的第一层，因为所学习的调制参数已经编码了足够的关于标签布局的信息。
因此，我们丢弃了生成器的编码器部分，这在最近的体系结构中经常使用。这种简化使得网络更轻量。此外，与现有的
类条件生成器类似，新生成器可以采用随机向量作为输入，从而为多模态综合提供了一种简单而自然的方法。

图4插图显示了我们的生成器架构，它使用了几个带有上采样层的ResNet块。用SPADE学习各归一化层的调制参数。
由于每个残差块在不同的尺度上运行，SPADE对语义掩码进行（下）采样以匹配空间分辨率。

我们使用与pix2pixHD相同的多尺度鉴别器和损耗函数来训练生成器，只不过我们用铰链损耗项替换了最小二乘损耗项。
我们测试了最近无条件GANs中使用的几个基于resnet的鉴别器，但以更高的GPU内存需求为代价观察到类似的结果。将
SPADE添加到鉴别器也会产生类似的性能。对于损耗函数，我们观察到去掉pix2pixHD损耗函数中的任何损耗项都会导致生成结果的退化

为什么SPADE效果更好？
相较于常见的归一化层，它可以更好地保存语义信息。具体来说，尽管像InstanceNorm这样的标准化层在几乎所有最先进
的条件图像合成模型中都是必不可少的部分，但是当它们被应用到统一（相同、均匀）或扁平（单调）的分割掩模中时，它们往往
会冲走语义信息。

让我们考虑一个简单的模块，它首先将卷积应用于分割掩码，然后进行归一化。此外，让我们假设一个带有单个标签的
分割掩码作为模块的输入(例如，所有像素都有相同的标签，如天空或草地)。在此设置下，卷积输出同样是均匀的，
不同的标签具有不同的均匀值。现在，在我们将InstanceNorm应用于输出之后，无论输入语义标签是什么，规范化
激活都将变为零。因此，语义信息完全丢失。这种限制适用于广泛的生成器体系结构，包括pix2pixHD及其变体，它
在所有中间层集中了语义掩码，只要网络对掩码应用卷积，然后进行归一化即可。图3，我们的经验表明，这正
是pix2pixHD的情况。由于分割掩码通常由几个统一的区域组成，在应用归一化时就会出现信息丢失的问题。

与此相反，SPADE生成器中的分割掩码是通过空间自适应调制而非归一化实现的。只规范化来自前一层的激活。
因此，SPADE生成器可以更好地保存语义信息。它在不丢失语义输入信息的情况下，享受规范化的好处。


多模态合成：
通过使用一个随机向量作为生成器的输入，我们的架构可以提供一个简单的方式用于多模态合成。也就是说，我们
可以附加一个编码器，将一个真实的图片处理成一个随机向量，然后将其喂入生成器。编码器和生成器组成变分自编
码器，编码器尝试捕获图像的样式，而生成器通过SPADE将编码的样式和分割掩码信息结合起来，重构原始图像。
在测试时，编码器还充当一个样式指导网络，以捕获目标图像的样式，如图1所示。对于训练，我们添加一个kl散度损失项。

实验：


性能指标：
采用先前工作的评价方案。具体来说，我们对合成的图像进行语义分割，并比较了预测的分割掩码与输入的真值的匹配程度。
